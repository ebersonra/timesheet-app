# TimesheetPro - Sistema de Controle de Ponto Multi-usu√°rio

Sistema moderno, responsivo e multi-usu√°rio para controle de ponto com c√°lculo autom√°tico de horas extras e gest√£o de presencial.

## üöÄ Caracter√≠sticas

- **Sistema Multi-usu√°rio**: Autentica√ß√£o, cadastro e gest√£o de m√∫ltiplos usu√°rios
- **Interface Moderna**: Design responsivo com CSS Grid e Flexbox
- **C√°lculos Autom√°ticos**: Horas extras, tempo de almo√ßo, valores monet√°rios
- **Controle Presencial**: Acompanhamento de dias presenciais e percentual obrigat√≥rio
- **Armazenamento Local**: Dados isolados por usu√°rio no localStorage
- **Exporta√ß√£o CSV**: Exportar dados individuais ou por departamento
- **Sistema de Backup**: Backup autom√°tico e lembretes peri√≥dicos
- **Padr√£o MVC**: Arquitetura escal√°vel e organizada
- **PWA Ready**: Preparado para ser Progressive Web App

## üìÅ Estrutura do Projeto

```
timesheet/
‚îú‚îÄ‚îÄ package.json           # Depend√™ncias Node.js
‚îú‚îÄ‚îÄ server.js             # Servidor Express (Padr√£o MVC)
‚îú‚îÄ‚îÄ index.html            # Interface principal da aplica√ß√£o
‚îú‚îÄ‚îÄ login.html            # Tela de login e cadastro
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.css      # Estilos principais
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components.css # Componentes UI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ responsive.css # Media queries
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.css      # Estilos de autentica√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ utils.js      # Utilit√°rios gerais
‚îÇ       ‚îú‚îÄ‚îÄ storage.js    # Gerenciamento localStorage
‚îÇ       ‚îú‚îÄ‚îÄ calculator.js # C√°lculos de timesheet
‚îÇ       ‚îú‚îÄ‚îÄ components.js # Componentes UI
‚îÇ       ‚îú‚îÄ‚îÄ user-manager.js # Gest√£o de usu√°rios
‚îÇ       ‚îú‚îÄ‚îÄ auth.js       # Sistema de autentica√ß√£o
‚îÇ       ‚îú‚îÄ‚îÄ backup-reminder.js # Sistema de backup
‚îÇ       ‚îú‚îÄ‚îÄ fix-dates.js  # Corre√ß√£o de datas
‚îÇ       ‚îî‚îÄ‚îÄ app.js       # Aplica√ß√£o principal (MVC)
```

## üõ†Ô∏è Instala√ß√£o e Execu√ß√£o

### 1. Instalar depend√™ncias
```bash
npm install
```

### 2. Executar servidor
```bash
npm start
# ou para desenvolvimento
npm run dev
```

### 3. Acessar aplica√ß√£o
```
http://localhost:3000
```

**Primeiro acesso**: O sistema redirecionar√° automaticamente para a tela de login (`/login.html`) onde voc√™ pode:
- **Cadastrar** um novo usu√°rio com nome, email, departamento
- **Fazer login** com credenciais existentes

Ap√≥s autentica√ß√£o, voc√™ ser√° redirecionado para a aplica√ß√£o principal (`/index.html`).

## üí° Funcionalidades

### ‚úÖ Implementadas

1. **Sistema de Autentica√ß√£o**
   - Tela de login e cadastro
   - Hash de senhas (implementa√ß√£o b√°sica)
   - Sess√µes de usu√°rio
   - Menu de usu√°rio com perfil e logout
   - Redirecionamento autom√°tico

2. **Gest√£o Multi-usu√°rio**
   - Cadastro com nome, email e departamento
   - Isolamento de dados por usu√°rio
   - Filtros por usu√°rio na interface
   - Estat√≠sticas individualizadas
   - Controle de acesso

3. **Registro de Ponto**
   - Data e hora de entrada/sa√≠da
   - Hor√°rio de almo√ßo (opcional)
   - Sele√ß√£o de turno/observa√ß√£o (predefinida)
   - Status SAP (Pendente, Conclu√≠do, Presencial)
   - Valida√ß√£o em tempo real
   - Vincula√ß√£o autom√°tica ao usu√°rio logado

4. **Controle de Presencial**
   - Acompanhamento de dias presenciais (meta: 8 dias)
   - Percentual presencial (m√≠nimo: 40%)
   - Cards visuais com indicadores de status
   - Diferencia√ß√£o entre trabalho presencial e remoto

5. **C√°lculos Autom√°ticos**
   - Total bruto de horas trabalhadas
   - Desconto do tempo de almo√ßo
   - Total l√≠quido de horas
   - Horas extras (baseado em 8h normais)
   - Valor monet√°rio das horas extras (50% adicional)
   - **Modo CLT**: C√°lculos conforme legisla√ß√£o trabalhista brasileira
   - **Adicional Noturno**: 20% para trabalho entre 22h-5h (CLT Art. 73)
   - **Horas Extras CLT**: Limitadas a 2h/dia, 50% m√≠nimo (CLT Art. 59)
   - **Valida√ß√µes CLT**: Intervalos obrigat√≥rios e limites de jornada

3. **Interface Responsiva**
   - Design moderno com CSS Grid/Flexbox
   - Adapta√ß√£o para mobile/tablet
   - Anima√ß√µes e transi√ß√µes suaves
   - Menu de usu√°rio responsivo
   - Layout otimizado para diferentes telas

4. **Gerenciamento de Dados**
   - Armazenamento isolado por usu√°rio
   - Backup autom√°tico com lembretes (7 dias)
   - Busca e filtros avan√ßados
   - Filtro por usu√°rio, turno e status SAP
   - Estat√≠sticas em tempo real por usu√°rio

5. **Sistema de Backup**
   - Backup autom√°tico local
   - Lembretes peri√≥dicos (configur√°vel)
   - Exporta√ß√£o CSV individual
   - Restaura√ß√£o de backup

6. **Exporta√ß√£o e Relat√≥rios**
   - Exportar para CSV com dados completos
   - Formato compat√≠vel com Excel
   - Dados incluem status SAP e informa√ß√µes do usu√°rio
   - **Relat√≥rios CLT**: Informa√ß√µes de conformidade e valores espec√≠ficos
   - **Campos CLT**: Adicional noturno, status de conformidade, valida√ß√µes
   - Relat√≥rios individuais por funcion√°rio

### üîÑ Pr√≥ximas Vers√µes

1. **Aprimoramentos de Autentica√ß√£o**
   - Recupera√ß√£o de senha
   - Autentica√ß√£o 2FA
   - Integra√ß√£o com OAuth (Google, Microsoft)
   - N√≠veis de permiss√£o (Admin, Usu√°rio)

2. **Relat√≥rios Avan√ßados**
   - Dashboard administrativo
   - Relat√≥rios mensais/anuais por departamento
   - Gr√°ficos de produtividade
   - An√°lise de padr√µes de trabalho
   - Comparativos entre usu√°rios

3. **Funcionalidades Administrativas**
   - Gest√£o de usu√°rios pelo admin
   - Configura√ß√£o de departamentos
   - Defini√ß√£o de metas personalizadas
   - Aprova√ß√£o de registros

4. **Importa√ß√£o de Dados**
   - Importar CSV com dados de usu√°rios
   - Migra√ß√£o de outras ferramentas
   - Importa√ß√£o em lote

3. **Configura√ß√µes Avan√ßadas**
   - Jornada de trabalho personalizada por usu√°rio
   - Diferentes tipos de hora extra
   - Configura√ß√£o de feriados por departamento
   - Temas customiz√°veis

4. **PWA Completo**
   - Service Worker
   - Notifica√ß√µes push para lembretes
   - Trabalho offline
   - Sincroniza√ß√£o autom√°tica

5. **Integra√ß√µes**
   - API REST para integra√ß√µes externas
   - Webhook para sistemas de RH
   - Integra√ß√£o com sistemas de ponto eletr√¥nico

## üìã Conformidade CLT

### **Caracter√≠sticas do Modo CLT**

O sistema agora possui **modo CLT completo** que implementa todas as regras da Consolida√ß√£o das Leis do Trabalho brasileira:

#### **Horas Extras (CLT Art. 59)**
- ‚úÖ **Adicional m√≠nimo**: 50% sobre valor da hora normal
- ‚úÖ **Domingos/Feriados**: 100% de adicional quando n√£o compensados
- ‚úÖ **Limite di√°rio**: M√°ximo 2 horas extras por dia
- ‚úÖ **Jornada m√°xima**: 10 horas di√°rias (8h normais + 2h extras)

#### **Adicional Noturno (CLT Art. 73)**
- ‚úÖ **Hor√°rio noturno**: 22h √†s 5h (urbano)
- ‚úÖ **Adicional**: 20% sobre valor da hora normal
- ‚úÖ **Hora reduzida**: 52min30s (cada hora noturna)
- ‚úÖ **C√°lculo autom√°tico**: Detec√ß√£o de per√≠odo noturno

#### **Valida√ß√µes Legais**
- ‚úÖ **Intervalos obrigat√≥rios**: 15min (>4h) ou 1h (>6h) - CLT Art. 71
- ‚úÖ **Limite de jornada**: M√°ximo 10h di√°rias conforme CLT
- ‚úÖ **Intervalo entre jornadas**: M√≠nimo 11h entre turnos (CLT Art. 66)
- ‚úÖ **Alertas visuais**: Avisos de n√£o conformidade

#### **Relat√≥rios de Conformidade**
```javascript
// Exemplo de relat√≥rio gerado
{
  totalRegistros: 20,
  conformes: 18,
  comAvisos: 2,
  comErros: 0,
  violacoes: [
    {
      registro: 5,
      data: "2025-01-15",
      tipo: "aviso",
      descricao: "Jornada > 6h requer intervalo m√≠nimo de 1h"
    }
  ],
  estatisticas: {
    totalHorasExtras: "40:30",
    totalValorHE: 1250.50,
    totalHorasNoturnas: "8:15", 
    totalValorNoturno: 180.75
  }
}
```

### **Como Usar o Modo CLT**

1. **Ativar CLT**: Marque a op√ß√£o "Aplicar Regras CLT" no formul√°rio
2. **Preencher dados**: Hor√°rios de entrada, sa√≠da e valor/hora
3. **Calcular**: Sistema aplica automaticamente todas as regras CLT
4. **Verificar avisos**: Revise alertas de conformidade se houver
5. **Exportar**: Relat√≥rio CSV inclui campos espec√≠ficos CLT

### **Benef√≠cios da Implementa√ß√£o CLT**

- üè¢ **Conformidade empresarial**: Atende fiscaliza√ß√£o trabalhista
- ‚öñÔ∏è **Redu√ß√£o de riscos**: Evita multas e processos trabalhistas  
- üìä **Transpar√™ncia**: C√°lculos corretos para funcion√°rios
- üìã **Auditoria facilitada**: Relat√≥rios detalhados de conformidade
- üí∞ **Precis√£o financeira**: Valores exatos conforme legisla√ß√£o

## üéØ Padr√µes Utilizados

### **MVC (Model-View-Controller)**
- **Model**: `StorageManager`, `UserManager` - Gerencia dados e usu√°rios
- **View**: HTML/CSS - Interface do usu√°rio  
- **Controller**: `TimesheetApp`, `AuthManager` - L√≥gica de neg√≥cio e autentica√ß√£o

### **Outros Padr√µes**
- **Singleton**: Classes principais s√£o instanciadas uma vez
- **Observer**: Event listeners para reatividade
- **Strategy**: Diferentes calculadoras para cen√°rios espec√≠ficos
- **Factory**: Gera√ß√£o de IDs e elementos DOM
- **Module Pattern**: Organiza√ß√£o do c√≥digo em m√≥dulos independentes

## üîß Configura√ß√£o

### Configura√ß√µes Padr√£o
```javascript
// Configura√ß√µes podem ser alteradas em:
static/js/calculator.js (modo tradicional)
static/js/calculator-clt.js (modo CLT)

// Configura√ß√µes Tradicionais
- Jornada normal: 8 horas
- Adicional HE: 50%
- Formato de hora: HH:MM
- Moeda: BRL (Real)

// Configura√ß√µes CLT
- Jornada normal: 8 horas (CLT Art. 58)
- Adicional HE m√≠nimo: 50% (CLT Art. 59)
- Adicional noturno: 20% (CLT Art. 73)
- Hora noturna: 52min30s (per√≠odo reduzido)
- Limite HE di√°rio: 2 horas m√°ximo
- Per√≠odo noturno: 22h √†s 5h (urbano)
```

### Personaliza√ß√£o de Turnos
```javascript
// Turnos dispon√≠veis (configur√°vel em index.html)
const TURNOS = [
  'Hor√°rio Comercial',
  'Extra Noturno', 
  'Plant√£o',
  'Home Office',
  'Sobreaviso',
  'Feriado',
  'Final de Semana',
  'Emerg√™ncia'
];
```

## üìà M√©tricas e Estat√≠sticas

### Cards de Dashboard (Por Usu√°rio)
1. **Total de Registros**: Quantidade de pontos registrados
2. **Horas Trabalhadas**: Soma total de horas l√≠quidas
3. **Horas Extras**: Total de horas extras acumuladas
4. **Valor HE Acumulado**: Valor monet√°rio das horas extras
5. **Dias Presenciais**: Contador atual vs. meta (X/8)
6. **% Presencial**: Percentual atual vs. m√≠nimo (40%)

### Indicadores Visuais
- üü¢ **Verde**: Meta atingida ou acima do esperado
- üü° **Amarelo**: Em progresso, aten√ß√£o necess√°ria
- üîµ **Azul**: Informa√ß√£o neutra
- üî¥ **Vermelho**: Abaixo do esperado ou erro

## üìä Exemplos de Uso

### Primeiro Acesso - Cadastro
```
1. Acesse http://localhost:3000
2. Clique em "Cadastre-se"
3. Preencha: Nome, Email, Senha, Departamento
4. Fa√ßa login autom√°tico ap√≥s cadastro
```

### Registro - Turno Comercial
```
Usu√°rio: Jo√£o Silva (TI)
Entrada: 08:00 (25/07)
Sa√≠da: 17:00 (25/07)
Almo√ßo: 12:00 - 13:00
Turno: Hor√°rio Comercial
Status SAP: Pendente
Resultado: 8h normais, 0h extras
```

### Registro - Trabalho Presencial
```
Usu√°rio: Maria Santos (RH)
Entrada: 09:00 (26/07)
Sa√≠da: 18:00 (26/07)
Almo√ßo: 12:30 - 13:30
Turno: Hor√°rio Comercial
Status SAP: Presencial
Resultado: 8h normais, 0h extras
Impacto: +1 dia presencial (contribui para meta 40%)
```

### Turno com Hora Extra
```
Usu√°rio: Carlos Lima (Opera√ß√µes)
Entrada: 08:00 (25/07)
Sa√≠da: 19:00 (25/07)
Almo√ßo: 12:00 - 13:00
Turno: Extra Noturno
Status SAP: Conclu√≠do
Resultado: 8h normais, 2h extras
Valor HE: R$ 60,00 (assumindo R$ 30/h base)
```

### **Registro CLT - Hor√°rio Noturno**
```
Usu√°rio: Ana Costa (Opera√ß√µes)
Entrada: 22:00 (25/07)
Sa√≠da: 06:00 (26/07)
Almo√ßo: 02:00 - 03:00
Turno: Extra Noturno
Modo CLT: ‚úÖ Ativado
Valor/Hora: R$ 25,00
Resultado CLT:
- Horas normais: 7h (com intervalo)
- Horas noturnas: 7h (22h-5h)
- Adicional noturno: R$ 35,00 (20% sobre 7h)
- Total CLT: R$ 210,00 (R$ 175 + R$ 35)
- Status: ‚úÖ Conforme CLT
```

### **Registro CLT - Com Avisos**
```
Usu√°rio: Pedro Silva (TI)
Entrada: 08:00 (26/07)
Sa√≠da: 20:00 (26/07)
Almo√ßo: -
Turno: Emerg√™ncia
Modo CLT: ‚úÖ Ativado
Valor/Hora: R$ 40,00
Resultado CLT:
- Horas trabalhadas: 10h (limite CLT)
- Horas extras: 2h (limite m√°ximo)
- Valor HE: R$ 120,00 (50% adicional)
- Total CLT: R$ 440,00
- Status: ‚ö†Ô∏è Com Avisos
- Avisos: "Jornada > 6h requer intervalo m√≠nimo de 1h (CLT Art. 71)"
```

### Gest√£o Multi-usu√°rio
```
Filtro por usu√°rio: "Jo√£o Silva (TI)"
Estat√≠sticas mostradas:
- Total registros: 15
- Horas trabalhadas: 120:00
- Horas extras: 8:00
- Dias presenciais: 6/8 (75% - acima do m√≠nimo 40%)
- Valor HE acumulado: R$ 240,00
```

## üîí Seguran√ßa e Privacidade

- **Autentica√ß√£o**: Sistema de login com hash de senhas
- **Isolamento de Dados**: Cada usu√°rio v√™ apenas seus pr√≥prios registros
- **CSP**: Content Security Policy configurado
- **Helmet**: Headers de seguran√ßa no servidor
- **Sanitiza√ß√£o**: XSS protection nos inputs
- **Valida√ß√£o**: Cliente e servidor
- **Backup Seguro**: Dados mantidos localmente no navegador

## ÔøΩ Gest√£o de Usu√°rios

### Estrutura de Dados do Usu√°rio
```javascript
{
  id: "user_123",
  name: "Jo√£o Silva",
  email: "joao@empresa.com",
  department: "TI",
  password: "hashed_password",
  createdAt: "2025-07-28T10:30:00.000Z",
  isActive: true
}
```

### Estrutura de Registros
```javascript
{
  // Dados do registro
  id: "record_456",
  dataEntrada: "2025-07-28",
  horaEntrada: "08:00",
  // ... outros campos de timesheet
  
  // Vincula√ß√£o do usu√°rio
  userId: "user_123",
  userName: "Jo√£o Silva",
  userDepartment: "TI",
  createdAt: "2025-07-28T08:00:00.000Z"
}
```

### Departamentos Dispon√≠veis
- Tecnologia da Informa√ß√£o (TI)
- Recursos Humanos (RH)
- Financeiro
- Opera√ß√µes
- Vendas
- Marketing
- Suporte
- Outros

## üì± Responsividade

- **Desktop**: Layout completo com menu de usu√°rio
- **Tablet**: Grid adaptativo com 2-3 cards por linha
- **Mobile**: Stack vertical, menu responsivo
- **Print**: Layout otimizado para impress√£o de relat√≥rios

## üé® Design System

### Cores
```css
--primary-color: #3b82f6    /* Azul principal */
--success-color: #10b981    /* Verde sucesso */
--warning-color: #f59e0b    /* Amarelo alerta */
--danger-color: #ef4444     /* Vermelho erro */
--info-color: #06b6d4       /* Azul informa√ß√£o */
```

### Componentes de Interface
```css
/* Cards de Estat√≠sticas */
.stat-card--success     /* Verde - meta atingida */
.stat-card--warning     /* Amarelo - em progresso */

/* Badges de Status */
.badge-success          /* Verde - conclu√≠do */
.badge-warning          /* Amarelo - pendente */
.badge-info            /* Azul - presencial */
.badge-secondary       /* Cinza - padr√£o */

/* Menu de Usu√°rio */
.user-menu-toggle      /* Bot√£o do menu */
.user-dropdown         /* Dropdown com op√ß√µes */
```

## üîß Configura√ß√£o Avan√ßada

### Configura√ß√µes de Presencial
```javascript
// Em static/js/storage.js
const MIN_PRESENTIAL_DAYS = 8;        // Meta de dias presenciais
const MIN_PRESENTIAL_PERCENT = 40;    // Percentual m√≠nimo obrigat√≥rio
```

### Configura√ß√µes de Backup
```javascript
// Em static/js/backup-reminder.js
this.checkInterval = 7 * 24 * 60 * 60 * 1000; // 7 dias para lembrete
```

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch (`git checkout -b feature/nova-funcionalidade`)
3. Commit suas mudan√ßas (`git commit -am 'Adiciona nova funcionalidade'`)
4. Push para a branch (`git push origin feature/nova-funcionalidade`)
5. Abra um Pull Request

## üìÑ Licen√ßa

MIT License - veja o arquivo LICENSE para detalhes.

## ÔøΩ Fluxo de Autentica√ß√£o

### 1. Primeiro Acesso
```
GET / ‚Üí Redireciona para /login.html
```

### 2. Cadastro de Usu√°rio
```
1. Usu√°rio preenche formul√°rio de cadastro
2. Sistema valida dados (email √∫nico, senha >= 6 chars)
3. Senha √© hasheada e usu√°rio salvo no localStorage
4. Login autom√°tico ap√≥s cadastro
5. Redirecionamento para /index.html
```

### 3. Login Existente
```
1. Usu√°rio insere email e senha
2. Sistema busca usu√°rio e valida credenciais
3. Sess√£o criada no localStorage
4. Menu de usu√°rio renderizado na interface
5. Dados filtrados por usu√°rio logado
```

### 4. Navega√ß√£o Protegida
```
- Toda p√°gina carrega UserManager.checkAuth()
- Se n√£o autenticado ‚Üí Redireciona para /login.html
- Se autenticado ‚Üí Carrega dados do usu√°rio
- Menu superior mostra: Nome, Departamento, Op√ß√µes
```

### 5. Logout
```
1. Usu√°rio clica em "Sair" no menu
2. Confirma√ß√£o de logout
3. SessionStorage √© limpo
4. Redirecionamento para /login.html
```

## ÔøΩüë®‚Äçüíª Desenvolvido por

Sistema desenvolvido com foco em **usabilidade**, **seguran√ßa multi-usu√°rio** e **escalabilidade empresarial**.

### Tecnologias Utilizadas
- **Frontend**: HTML5, CSS3 (Grid/Flexbox), Vanilla JavaScript
- **Backend**: Node.js, Express.js
- **Armazenamento**: localStorage (navegador)
- **Autentica√ß√£o**: Sistema pr√≥prio com hash de senhas
- **Design**: CSS responsivo, Mobile-first
- **Arquitetura**: MVC, Padr√µes de Design

### Recursos Implementados
- ‚úÖ Sistema multi-usu√°rio completo
- ‚úÖ Controle de presencial com m√©tricas
- ‚úÖ Interface responsiva e moderna
- ‚úÖ Sistema de backup inteligente
- ‚úÖ Filtros avan√ßados por usu√°rio/departamento
- ‚úÖ Exporta√ß√£o de dados personalizada
- ‚úÖ Isolamento de dados por usu√°rio
- ‚úÖ Menu de usu√°rio com perfil

---

**TimesheetPro** - Controle de ponto profissional e multi-usu√°rio! ‚è∞üë•
